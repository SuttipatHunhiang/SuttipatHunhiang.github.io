<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProPrompter - Web Teleprompter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Custom scrollbar hiding for cleaner look */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Marker line to show reading position */
        .reading-marker {
            position: absolute;
            top: 35%; /* Sweet spot for reading */
            left: 0;
            width: 100%;
            height: 2px;
            background: rgba(255, 0, 0, 0.3);
            pointer-events: none;
            z-index: 10;
            display: none; /* Hidden by default */
        }
        
        .marker-active .reading-marker {
            display: block;
        }

        .marker-active .reading-marker::before {
            content: '▶';
            color: rgba(255, 0, 0, 0.5);
            position: absolute;
            left: 10px;
            top: -10px;
            font-size: 20px;
        }

        .marker-active .reading-marker::after {
            content: '◀';
            color: rgba(255, 0, 0, 0.5);
            position: absolute;
            right: 10px;
            top: -10px;
            font-size: 20px;
        }

        /* Focus styles for the content area */
        [contenteditable]:focus {
            outline: none;
        }

        /* Flip class for mirror mode */
        .mirror-x {
            transform: scaleX(-1);
        }
        
        /* Flip Y for upside down monitors */
        .mirror-y {
            transform: scaleY(-1);
        }

        .mirror-xy {
            transform: scale(-1, -1);
        }

        /* Smooth UI transitions */
        .control-panel {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        
        .control-panel.hidden-ui {
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px);
        }

        body {
            background-color: #000;
            color: #fff;
            overflow: hidden; /* Prevent body scroll, we scroll the container */
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col font-sans relative overflow-hidden">

    <!-- Reading Marker (Visual Aid) -->
    <div id="markerArea" class="absolute inset-0 pointer-events-none z-20 marker-active">
        <div class="reading-marker"></div>
    </div>

    <!-- Main Prompter Area -->
    <div id="prompterContainer" class="flex-grow relative overflow-y-auto no-scrollbar scroll-smooth w-full h-full p-4 md:p-12 text-center leading-normal outline-none">
        <div 
            id="scriptContent" 
            contenteditable="true" 
            class="outline-none min-h-[150vh] pt-[40vh] pb-[50vh] max-w-4xl mx-auto"
            style="font-size: 4rem;"
        >
            <p>Welcome to <strong>ProPrompter</strong>.</p>
            <br>
            <p>This is a simple, robust teleprompter for your browser.</p>
            <br>
            <p><strong>Click here</strong> to edit this text, or paste your own script.</p>
            <br>
            <p>Use the controls at the bottom to adjust speed and font size.</p>
            <br>
            <p>Press <strong>SPACE</strong> to Play/Pause.</p>
            <p>Use <strong>UP/DOWN</strong> arrows to adjust speed.</p>
            <br>
            <p>Happy recording!</p>
            <br>
            <p>--- End of Script ---</p>
        </div>
    </div>

    <!-- Control Bar -->
    <div id="controls" class="control-panel absolute bottom-6 left-1/2 transform -translate-x-1/2 bg-gray-900/90 backdrop-blur-md border border-gray-700 rounded-2xl shadow-2xl p-4 flex flex-col gap-4 z-50 w-[90%] max-w-3xl transition-all duration-300">
        
        <!-- Top Row: Main Transport -->
        <div class="flex items-center justify-between gap-4">
            
            <button id="btnPlay" class="w-14 h-14 flex items-center justify-center rounded-full bg-green-600 hover:bg-green-500 text-white shadow-lg transition-transform active:scale-95">
                <i class="fas fa-play text-xl ml-1"></i>
            </button>

            <button id="btnReset" class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-700 hover:bg-gray-600 text-white transition-colors" title="Reset to Top">
                <i class="fas fa-undo"></i>
            </button>

            <!-- Speed Control -->
            <div class="flex-1 flex flex-col justify-center">
                <div class="flex justify-between text-xs text-gray-400 mb-1">
                    <span>Speed</span>
                    <span id="speedVal">10</span>
                </div>
                <input type="range" id="speedRange" min="0" max="50" value="10" step="0.5" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-green-500">
            </div>

            <!-- Font Size Control -->
            <div class="flex-1 flex flex-col justify-center">
                <div class="flex justify-between text-xs text-gray-400 mb-1">
                    <span>Size</span>
                    <span id="sizeVal">4rem</span>
                </div>
                <input type="range" id="sizeRange" min="1" max="10" value="4" step="0.1" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
            </div>

            <button id="btnSettings" class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-700 hover:bg-gray-600 text-white transition-colors">
                <i class="fas fa-cog"></i>
            </button>
        </div>

        <!-- Expanded Settings (Hidden by default) -->
        <div id="extendedSettings" class="hidden grid-cols-2 md:grid-cols-4 gap-3 pt-2 border-t border-gray-700 mt-2">
            
            <button id="btnMirrorX" class="px-3 py-2 bg-gray-800 hover:bg-gray-700 rounded text-sm text-gray-300 flex items-center justify-center gap-2">
                <i class="fas fa-arrows-alt-h"></i> Flip X
            </button>
            
            <button id="btnMirrorY" class="px-3 py-2 bg-gray-800 hover:bg-gray-700 rounded text-sm text-gray-300 flex items-center justify-center gap-2">
                <i class="fas fa-arrows-alt-v"></i> Flip Y
            </button>

            <button id="btnTheme" class="px-3 py-2 bg-gray-800 hover:bg-gray-700 rounded text-sm text-gray-300 flex items-center justify-center gap-2">
                <i class="fas fa-adjust"></i> Theme
            </button>

            <button id="btnMarker" class="px-3 py-2 bg-gray-800 hover:bg-gray-700 rounded text-sm text-gray-300 flex items-center justify-center gap-2">
                <i class="fas fa-eye-slash"></i> Marker
            </button>

        </div>
    </div>

    <!-- Hover Trigger to Show UI if hidden -->
    <div id="uiTrigger" class="absolute bottom-0 left-0 w-full h-16 z-40"></div>

    <script>
        // --- Elements ---
        const prompterContainer = document.getElementById('prompterContainer');
        const scriptContent = document.getElementById('scriptContent');
        const btnPlay = document.getElementById('btnPlay');
        const btnReset = document.getElementById('btnReset');
        const btnSettings = document.getElementById('btnSettings');
        const btnMirrorX = document.getElementById('btnMirrorX');
        const btnMirrorY = document.getElementById('btnMirrorY');
        const btnTheme = document.getElementById('btnTheme');
        const btnMarker = document.getElementById('btnMarker');
        const extendedSettings = document.getElementById('extendedSettings');
        const controls = document.getElementById('controls');
        const uiTrigger = document.getElementById('uiTrigger');
        
        const speedRange = document.getElementById('speedRange');
        const speedVal = document.getElementById('speedVal');
        const sizeRange = document.getElementById('sizeRange');
        const sizeVal = document.getElementById('sizeVal');
        const markerArea = document.getElementById('markerArea');

        // --- State ---
        let isPlaying = false;
        let speed = 10; // Pixels per second (approx)
        let scrollAccumulator = 0;
        let lastFrameTime = 0;
        let animationFrameId;
        let isMirrorX = false;
        let isMirrorY = false;
        let isWhiteTheme = false;
        let isMarkerVisible = true;
        let uiTimeout;

        // --- Core Logic ---

        function updateSpeedDisplay() {
            speedVal.innerText = speed;
        }

        function togglePlay() {
            isPlaying = !isPlaying;
            updatePlayButton();
            
            if (isPlaying) {
                // If we are at the very bottom, reset to top before playing
                if(Math.ceil(prompterContainer.scrollTop + prompterContainer.clientHeight) >= prompterContainer.scrollHeight) {
                    prompterContainer.scrollTop = 0;
                }
                lastFrameTime = performance.now();
                animationFrameId = requestAnimationFrame(gameLoop);
                hideUI();
            } else {
                cancelAnimationFrame(animationFrameId);
                showUI();
            }
        }

        function updatePlayButton() {
            const icon = btnPlay.querySelector('i');
            if (isPlaying) {
                icon.className = 'fas fa-pause text-xl ml-0';
                btnPlay.classList.replace('bg-green-600', 'bg-red-600');
                btnPlay.classList.replace('hover:bg-green-500', 'hover:bg-red-500');
            } else {
                icon.className = 'fas fa-play text-xl ml-1';
                btnPlay.classList.replace('bg-red-600', 'bg-green-600');
                btnPlay.classList.replace('hover:bg-red-500', 'hover:bg-green-500');
            }
        }

        function gameLoop(timestamp) {
            if (!isPlaying) return;

            // Calculate delta time in seconds
            const deltaTime = (timestamp - lastFrameTime) / 1000;
            lastFrameTime = timestamp;

            // Simple speed logic: speed value * multiplier * delta
            // Multiplier 5 makes the slider feel "right" (1-50 range)
            const pixelsToScroll = (speed * 5) * deltaTime;
            
            scrollAccumulator += pixelsToScroll;

            // Apply scroll when we have at least 1 pixel (or more for smoothness)
            if (scrollAccumulator >= 1) {
                const pixels = Math.floor(scrollAccumulator);
                prompterContainer.scrollTop += pixels;
                scrollAccumulator -= pixels;
            }

            // Auto-stop at bottom
            if(Math.ceil(prompterContainer.scrollTop + prompterContainer.clientHeight) >= prompterContainer.scrollHeight) {
                isPlaying = false;
                updatePlayButton();
                showUI();
                return;
            }

            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function resetScroll() {
            prompterContainer.scrollTop = 0;
            scrollAccumulator = 0;
            if(isPlaying) togglePlay(); // Pause on reset
        }

        // --- UI Handling ---

        function showUI() {
            controls.classList.remove('hidden-ui');
            document.body.style.cursor = 'default';
            clearTimeout(uiTimeout);
        }

        function hideUI() {
            if (!isPlaying) return; // Don't hide if paused
            
            // Wait 2 seconds then hide
            uiTimeout = setTimeout(() => {
                controls.classList.add('hidden-ui');
                document.body.style.cursor = 'none'; // Hide cursor for clean reading
            }, 2000);
        }

        // --- Event Listeners ---

        // Play/Pause
        btnPlay.addEventListener('click', togglePlay);

        // Reset
        btnReset.addEventListener('click', resetScroll);

        // Speed Input
        speedRange.addEventListener('input', (e) => {
            speed = parseFloat(e.target.value);
            updateSpeedDisplay();
        });

        // Font Size Input
        sizeRange.addEventListener('input', (e) => {
            const size = e.target.value;
            scriptContent.style.fontSize = `${size}rem`;
            sizeVal.innerText = `${size}rem`;
        });

        // Toggle Settings
        btnSettings.addEventListener('click', () => {
            extendedSettings.classList.toggle('hidden');
            extendedSettings.classList.toggle('grid');
        });

        // Mirror X
        btnMirrorX.addEventListener('click', () => {
            isMirrorX = !isMirrorX;
            updateMirrorTransform();
            btnMirrorX.classList.toggle('text-green-400');
        });

        // Mirror Y
        btnMirrorY.addEventListener('click', () => {
            isMirrorY = !isMirrorY;
            updateMirrorTransform();
            btnMirrorY.classList.toggle('text-green-400');
        });

        function updateMirrorTransform() {
            prompterContainer.classList.remove('mirror-x', 'mirror-y', 'mirror-xy');
            if (isMirrorX && isMirrorY) {
                prompterContainer.classList.add('mirror-xy');
            } else if (isMirrorX) {
                prompterContainer.classList.add('mirror-x');
            } else if (isMirrorY) {
                prompterContainer.classList.add('mirror-y');
            }
        }

        // Theme Toggle
        btnTheme.addEventListener('click', () => {
            isWhiteTheme = !isWhiteTheme;
            if (isWhiteTheme) {
                document.body.style.backgroundColor = '#f3f4f6'; // Gray-100
                document.body.style.color = '#111827'; // Gray-900
                btnTheme.innerHTML = '<i class="fas fa-moon"></i> Dark Mode';
            } else {
                document.body.style.backgroundColor = '#000';
                document.body.style.color = '#fff';
                btnTheme.innerHTML = '<i class="fas fa-adjust"></i> Light Mode';
            }
        });

        // Marker Toggle
        btnMarker.addEventListener('click', () => {
            isMarkerVisible = !isMarkerVisible;
            if(isMarkerVisible) {
                markerArea.classList.add('marker-active');
                btnMarker.classList.remove('text-red-400');
            } else {
                markerArea.classList.remove('marker-active');
                btnMarker.classList.add('text-red-400');
            }
        });

        // Mouse movement to show UI
        document.addEventListener('mousemove', () => {
            showUI();
            hideUI();
        });

        // Click trigger area to show UI
        uiTrigger.addEventListener('mouseenter', showUI);

        // Keyboard Shortcuts
        document.addEventListener('keydown', (e) => {
            // Don't trigger if user is editing the text (unless it's a specific command key)
            if (document.activeElement === scriptContent) return;

            switch(e.code) {
                case 'Space':
                    e.preventDefault();
                    togglePlay();
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    speed = Math.min(parseFloat(speedRange.max), speed + 1);
                    speedRange.value = speed;
                    updateSpeedDisplay();
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    speed = Math.max(parseFloat(speedRange.min), speed - 1);
                    speedRange.value = speed;
                    updateSpeedDisplay();
                    break;
                case 'Home':
                    e.preventDefault();
                    resetScroll();
                    break;
            }
        });

        // Initialize
        updateSpeedDisplay();
        hideUI(); // Start setup for auto-hide
    </script>
</body>
</html>